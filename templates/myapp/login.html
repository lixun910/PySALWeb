<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GeoDa.app</title>
<style>
html { 
  background: url({{url_prefix}}/media/img/bg3.jpg) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
#login {
    width: 80%;
    height: 500px;
    position: absolute;
    top:10;
    left: 0;
    right: 0;
    margin: auto;
}
.logintable, logintable TD, logintable TH{
  margin-left:10px;
  font-family: Century Gothic;
  font-size: 10pt;
  color: #666;
}
.logintable input{
  padding: 4px;
  border: solid 1px #dcdcdc;
  transition: box-shadow 0.3s, border 0.3s;
}
.signuptable input{
  padding: 10px;
  border: solid 1px #dcdcdc;
  transition: box-shadow 0.3s, border 0.3s;
  color: #333;
}
.signuptable input:focus,
.signuptable input.focus {
  border: solid 1px #707070;
  box-shadow: 0 0 5px 1px #969696;
}
.content {
  padding-top: 20px;
  width: 80%;
  /*border: 1px red solid;*/
}
.brand {
text-align: left;
}
.geoda_title {
text-align: left;
-webkit-font-smoothing: antialiased;
color: rgb(255, 255, 255);
cursor: auto;
display: block;
font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
font-size: 40px;
font-weight: bold;
height: auto;
line-height: 20px;
text-decoration: none;
text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 0px;
width: auto;
margin-top: 20px;
}
h2 {
text-align: left;
-webkit-font-smoothing: antialiased;
color: rgb(255, 255, 255);
display: block;
font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
font-size: 28px;
font-weight: normal;
height: 66px;
line-height: 33.6px;
margin-bottom: 20px;
margin-left: 0px;
margin-right: 0px;
margin-top: 15px;
padding-left: 49px;
padding-right: 40px;
text-rendering: optimizeLegibility;
text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 0px;
}
/* CSSTerm.com Simple CSS menu */

.menu_simple ul {
    margin-left: 180px; 
    margin-top: 120px;
    padding: 0;
    width:285px;
    list-style-type: none;
}

.menu_simple ul li a {
-webkit-font-smoothing: antialiased;
-webkit-user-select: none;
border-bottom-left-radius: 5px;
border-bottom-right-radius: 5px;
border-top-left-radius: 5px;
border-top-right-radius: 5px;
color: rgb(255, 255, 255);
text-align: left;
text-decoration: none;
text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 0px;
font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
font-size: 13px;
height: 14px;
line-height: 14px;
    text-decoration: none;
    color: white; 
    padding: 10.5px 11px;
    display:block;
}
 
.menu_simple ul li a:hover {
    text-decoration: underline;
}
 
.menu_simple ul li a:hover, .menu_simple ul li .current {
    color: white;
}

</style>

<link rel="stylesheet" href="../../media/css/header.css" />
<link rel="stylesheet" href="../../media/css/tabs.css" />


<script src="{{url_prefix}}/media/js/jquery.min.js"></script>
<script src="{{url_prefix}}/media/js/utils.js"></script>
<script src="{{url_prefix}}/media/js/login.js"></script>
<link rel="stylesheet" href="{{url_prefix}}/media/css/{{theme_jquery}}/jquery-ui-1.10.4.custom.min.css">
</head>
<body>
<div style="width:100%;height:140px;"></div>
<div class="content" style="width:80%;margin:0 auto;">
  <div style="float:left;width:600px;margin-top:20px;">
    
    <img id="logo" style="float:left;text-align:top;margin-right:28px;opacity:0.8;" src="../../media/img/geoda-logo-white.png"> 
    <div class="geoda_title"> 
      GeoDa-Web
      <h2 style="">The cloud based GeoDa <br>for your spatial data analysis.</h2>
    </div>

<div class="menu_simple">
<ul>

<li><a href="#">Examples</a></li>
<li><a href="#">Projects</a></li>
<li><a href="#">APIs</a></li>
<li><a href="#">Contact</a></li>
<li><a href="#">Help</a></li>
<li><a href="#">About</a></li>
<li><a href="#">Copyright &copy; 2015 geodacenter.asu.edu</a></li>
</ul>
</div>


    
  </div>
  <div class="tabs" style="padding-left: 20px;width:400px;">
    <ul class="tab-links">
      <li class="active"><a href="#tab1">Login to PySAL-Cloud</a></li>
      <li><a href="#tab2">No account? Sign Up</a></li>
    </ul>

    <div class="tab-content" style="width:350px; height:400px;">
      <div id="tab1" class="tab active" style="text-align: left;">
        <p>
          <form id="form-login" method="post">{% csrf_token %}
          <table class="logintable">
            <tr><td>Your Email:</td><td>Password:</td></tr>
            <tr>
              <td><input type="text" name="lemail" value=''></input></td>
              <td>
                <input type="password" name="lpassword" value=''></input>&nbsp;
                <button id="btn_login" type="submit" class="ui-state-default button-text-only">Login </button>
              </td>
            </tr>
          </table>
          <br/><br/>
          &nbsp;&nbsp;&nbsp;<font color="red" style="font-size:10px" face="Century Gothic">{{error_msg}}</font>
          <br/><br/>
          {% if error_msg != "" %}<br>
          &nbsp;&nbsp;&nbsp;<font color="blue" style="font-size:10px" face="Century Gothic">Forget my password?</font>
          {% endif %}
          </form>
        </p>
        <br/><br/>
        <p style="border-top: 1px solid #ccc">
        </p>
        <p style="text-align:center">
          <a href="{% url 'social:begin' 'twitter' %}?next={{ request.path }}"><img src="../../media/img/login-twitter.png"></a>
        </p>
        <p style="text-align:center">
          <a href="{% url 'social:begin' 'facebook' %}?next={{ request.path }}"><img src="../../media/img/login-facebook.png"></a>
        </p>
        <p style="text-align:center">
          <a href="{% url 'social:begin' 'google-oauth2' %}?next={{ request.path }}"><img src="../../media/img/login-google.png"></a>
        </p>
        <br>
      </div>

      <div id="tab2" class="tab" style="text-align: left;">
        <br/><br/><br/>
        <form id="form-signup" method="post" action="../signup/">{% csrf_token %}
          <table class="signuptable" width="400px">
            <tr>
              <td width=320>
                <input type="text" name="first_name" value='First Name' style="width:135px"></input>
                <input type="text" name="last_name" value='Last Name'></input>
              </td>
              <td><p id="chk_name_msg" style="margin-left: -180px; font-size:10px;font-family: Century Gothic;color: red; "></p></td>
            </tr>
            <tr>
              <td>
                <input style="width:290px" type="text" name="email" value='Email'></input>
                <img id="img-id-chk" src="{{url_prefix}}/media/img/checkmark.png">
                <img id="img-id-nochk" src="{{url_prefix}}/media/img/uncheckmark.gif">
                <img id="img-id-spin" src="{{url_prefix}}/media/img/loading_small.gif">
              </td>
              <td><p id="chk_email_msg" style="margin-left: -180px; font-size:10px;font-family: Century Gothic;color: red; "></p></td>
            </tr>
            <tr>
              <td>
                <input style="width:290px" type="text" name="reemail" value='Re-enter Email'></input>
              </td>
              <td><p id="chk_reemail_msg" style="margin-left: -180px;font-size:10px;font-family: Century Gothic;color: red; "></p></td>
            </tr>
            <tr>
              <td>
                <input style="width:290px" type="text" name="password" value='Enter Password'> </input>
              </td>
              <td><p id="chk_pwd_msg" style="margin-left: -180px; font-size:10px;font-family: Century Gothic;color: red; "></p></td>
            </tr>
          </table>
          <br/>
          &nbsp;&nbsp;<img id="account" src="../../media/img/user.png" align=""><font style="font-size:10px" face="Century Gothic"> By clicking Sign Up, you agree to our Terms and Policy.</font>
          <p class="text-align:right;">
          <button id="btn_signup" type="submit" class="ui-state-default button-text-only" style="width:100">Sign Up</button>
          </p>
        </form>
      </div>
    <br/><br/><br/><br/><br/>
    <br/><br/><br/><br/><br/>
    <br/><br/><br/><br/><br/>
    
    </div>
</div>
<script>
$(document).ready(function() {
  $('.tabs .tab-links a').on('click', function(e)  {
    var currentAttrValue = $(this).attr('href');
   
    // Show/Hide Tabs
    $('.tabs ' + currentAttrValue).fadeIn(400).siblings().hide();
   
    // Change/remove current tab to active
    $(this).parent('li').addClass('active').siblings().removeClass('active');
   
    e.preventDefault();
  });
});

$("#img-id-chk, #img-id-nochk, #img-id-spin").hide();          

$('#btn_login').click( function() {
  $.post("../login/", $("form-login").serialize())
  .done(function(data) {
    console.log(data);
    location.reload();
  })
  .fail( function() {
    console.log("error");
  });
});

$('#btn_signup').submit( function(event) {
  if ( $('#chk_email_mmsg').text() != "" || $('#chk_reemail_msg').text() != ""|| $('.ignuptable input[name=password]').val() == "" ) {
    return;
  }
  event.preventDefault(); 
});

function checkDupEmail(email) {
  //$('#img-id-spin').show();
  $.get("../dup_email/", {'email': email})
  .done( function(data) {
   // $('#img-id-spin').hide();
    if (data == 1) {
      //$('#img-id-nochk').show();
      $('#chk_email_msg').text("Email address already exists.");
    } else {
      $('#chk_email_msg').text("");
      $('#img-id-chk').show();
    }
  })
  .always(function(){
  });
}

function setupInput(name, placeholder) {
  $(".signuptable input[name="+name+"]").focus(function() {
    if ($(this).val() == placeholder) {
      $(this).val('');
    }
  }).blur(function(){
    if ($(this).val() == '') {
      $(this).val(placeholder);
    } else {
      if (name == "email") {
        if (!isValidEmailAddress( $(this).val()) ){
          $('#chk_email_msg').text("Email address is not valid.");
        } else {
          checkDupEmail( $(this).val() );
        }
      } else if (name == "reemail") {
        if ( $(this).val() != $('.signuptable input[name=email]').val() ) {
          $('#chk_reemail_msg').text("Re-entered Email address does not match.");
        }
      } else if (name == "password") {
        if ( $(this).val() == "" ) {
          $('#chk_pwd_msg').text("Password should not be empty.");
        }
      } else if (name == "first_name") {
        if ( $(this).val() == "First Name" ) {
          $('#chk_name_msg').text("First Name should not be empty.");
        }
      } else if (name == "last_name") {
        if ( $(this).val() == "Last Name" ) {
          $('#chk_name_msg').text("Last Name should not be empty.");
        }
      }
    }
  });
}
setupInput("first_name", "First Name");
setupInput("last_name", "Last Name");
setupInput("email", "Email");
setupInput("reemail", "Re-enter Email");

$('.signuptable input[name=password]').focus(function() {
  if ($(this).val() == "Enter Password") {
    $(this).attr("type", "password");
    $(this).val('');
  }
});
$('.signuptable input[name=password]').blur(function() {
  if ($(this).val() == '') {
    $(this).attr("type", "text");
    $(this).val("Enter Password");
  }
});
</script>
</body>
</html>
